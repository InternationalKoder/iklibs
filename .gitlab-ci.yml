image: rikorose/gcc-cmake:gcc-8

stages:
  - build
  - release

compile:
  stage: build
  script:
    - cmake -G"Unix Makefiles" -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=$(pwd)/release -DBUILD_EXAMPLES:BOOL=OFF
    - make -j 4
  artifacts:
    paths:
      - CMakeFiles
      - Makefile
      - ./*/CMakeFiles
      - ./*/Makefile
    expire_in: 1h

install:
  stage: release
  only:
    - tags
  script:
    - mkdir ./release
    - make install -j 4
  artifacts:
    paths:
      - release
    name: iklibs-release

documentation:
  stage: release
  only:
    - tags
  script:
    - doxygen Doxyfile
  artifacts:
    paths:
      - html
    name: html-doc
